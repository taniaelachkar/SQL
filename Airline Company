# What is the build date of the airplanes that have flown in 2014? 
SELECT AIRCRAFT_REGISTRATION,BUILD_DATE,TICKETS.FLIGHT_DATE FROM AIRPLANES 
INNER JOIN TICKETS ON AIRCRAFT_REGISTRATION=AIRCRAFT_ID
WHERE TICKETS.FLIGHT_DATE BETWEEN '2014-01-01' AND '2014-12-31'
GROUP BY AIRCRAFT_REGISTRATION,BUILD_DATE,TICKETS.FLIGHT_DATE;

# How many passengers born in the 1970s have flown to Paris? 
SELECT COUNT(PASSENGER_ID) AS NUMBER_PASSENGERS
FROM TICKETS,PASSENGERS,ROUTES WHERE TICKETS.PASSENGER_ID=PASSENGERS.ID
AND TICKETS.ROUTE_CODE=ROUTES.ROUTE_CODE
AND PASSENGERS.BIRTH_DATE BETWEEN '1970-01-01' AND '1979-12-31'
AND UPPER(ROUTES.DESTINATION)='PARIS'; 

# What is the telephone number of the oldest passenger?
SELECT NAME,BIRTH_DATE,TELEPHONE FROM PASSENGERS
GROUP BY NAME,BIRTH_DATE,TELEPHONE 
HAVING BIRTH_DATE=(SELECT MIN(BIRTH_DATE) FROM PASSENGERS);

# How many airplanes have more than 300 seats and tickets more expensive than 1000 euros? 
SELECT COUNT(DISTINCT AIRCRAFT_ID) AS NUMBER_PLANES
FROM TICKETS,AIRPLANES,ROUTES WHERE AIRCRAFT_ID=AIRCRAFT_REGISTRATION 
AND TICKETS.ROUTE_CODE=ROUTES.ROUTE_CODE 
AND AIRPLANES.SEATS>300 AND ROUTES.PRICE>1000;

# Find the tickets associated to all the flights to Toronto in airplanes built before 2010 for passengers born after January 1st, 2000?
SELECT TICKET_ID,TICKETS.ROUTE_CODE,ROUTES.DESTINATION,AIRPLANES.BUILD_DATE,
PASSENGERS.BIRTH_DATE FROM TICKETS,ROUTES,AIRPLANES,PASSENGERS 
WHERE TICKETS.ROUTE_CODE=ROUTES.ROUTE_CODE AND AIRCRAFT_ID=AIRCRAFT_REGISTRATION
AND PASSENGER_ID=ID 
AND UPPER(ROUTES.DESTINATION)='TORONTO' AND AIRPLANES.BUILD_DATE<'2010-01-01'
AND PASSENGERS.BIRTH_DATE>'2000-01-01'
GROUP BY TICKET_ID,TICKETS.ROUTE_CODE,ROUTES.DESTINATION,AIRPLANES.BUILD_DATE,
PASSENGERS.BIRTH_DATE;

# Obtain the routes that have a price lower than the average price of all the routes with the same origin
SELECT ROUTES.ORIGIN,ROUTES.PRICE,T1.AVG_PRICE FROM ROUTES 
INNER JOIN (SELECT ORIGIN,AVG(PRICE) AS AVG_PRICE
FROM ROUTES GROUP BY ORIGIN) AS T1 
ON ROUTES.ORIGIN=T1.ORIGIN
WHERE ROUTES.PRICE<T1.AVG_PRICE;

# For each origin, how many tickets have been sold that cost more than 300 euros?
SELECT ORIGIN,COUNT(TICKETS.TICKET_ID) AS NUMBER_TICKETS_SOLD FROM ROUTES 
INNER JOIN TICKETS ON ROUTES.ROUTE_CODE=TICKETS.ROUTE_CODE 
WHERE PRICE>300
GROUP BY ORIGIN;

# What is the airline's revenue?
SELECT SUM(PRICE) AS TOTAL_EARNED FROM ROUTES 
INNER JOIN TICKETS ON ROUTES.ROUTE_CODE=TICKETS.ROUTE_CODE;

# List the price of each ticket, showing the most expensive one first
SELECT TICKET_ID,ROUTES.PRICE FROM TICKETS INNER JOIN ROUTES 
ON TICKETS.ROUTE_CODE=ROUTES.ROUTE_CODE 
GROUP BY TICKET_ID,ROUTES.PRICE
ORDER BY ROUTES.PRICE DESC LIMIT 20;

# Obtain the name and telephone number of the passengers who flew on route R7203 on December 28th, 2015 in planes with more than 300 seats
SELECT NAME,TELEPHONE FROM PASSENGERS,TICKETS,AIRPLANES
WHERE AIRPLANES.AIRCRAFT_REGISTRATION=TICKETS.AIRCRAFT_ID
AND TICKETS.PASSENGER_ID=PASSENGERS.ID
AND AIRPLANES.SEATS>300
AND TICKETS.ROUTE_CODE='R7203'
AND TICKETS.FLIGHT_DATE='2005-12-28';
